<% cache ['segments', @current] do %>
<div class="segments">
  <%= link_to '全部订单', wechat_shop_orders_path, class: "segment-item #{@current == 'orders_index' ? "active" : ""}" %>
  <%= link_to '待付款', no_pay_wechat_shop_orders_path, class: "segment-item #{@current == 'orders_no_pay' ? "active" : ""}" %>
  <%= link_to '待收货', shipping_wechat_shop_orders_path, class: "segment-item #{@current == 'orders_shipping' ? "active" : ""}" %>
</div>
<% end %>

<% if @orders.empty? %>
<%= render_empty_result %>
<% else %>
  <div class="orders">
    <% cache ['orders', @orders.to_a, 'v1'] do %>
    <%= render @orders %>
    <% end %>
  </div>
<% end %>

<% content_for :tabbar do %>
  <%= render '/wechat_shop/shared/tabbar' %>
<% end %>

<% content_for :scripts do %>

<script>
<%
@sign_package = WX::Sign.sign_package(request.original_url)
@pay_params = WX::Pay.generate_jsapi_params('wx201604162008434cb1b4357a0145578425')
%>
wx.config({
  debug: <%= @sign_package[:debug] %>,
  appId: '<%= @sign_package[:appId] %>',
  timestamp: <%= @sign_package[:timestamp] %>,
  nonceStr: '<%= @sign_package[:nonceStr] %>',
  signature: '<%= @sign_package[:signature] %>',
  jsApiList: ['chooseWXPay','onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareQZone','openLocation','getLocation']
  
});

</script>

<script>
function showOrder(ele) {
  var $ele = $(ele);
  window.location.href = '<%= wechat_shop_root_path %>/orders/' + $ele.data('order-no');
  return false;
}

function payment(event,ele) {
  if (event.stopPropagation) {
    event.stopPropagation();
  } else {
    event.cancelBubble = true;
  }
  // alert(123);
  
  wx.chooseWXPay({
      timestamp: <%= @pay_params[:timeStamp] %>,
      nonceStr: '<%= @pay_params[:nonceStr] %>',
      package: '<%= @pay_params[:package] %>',
      signType: 'MD5',
      paySign: '<%= @pay_params[:paySign] %>',
      success: function (res) {
          // 支付成功后的回调函数
          console.log(res);
      }
  });
  
  return false;
}
</script>
<% end %>