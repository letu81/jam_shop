<% if @allow_commit %>
  <% if @success %>
    
    <% if @unified_order_success %>
      wx.chooseWXPay({
        timestamp: <%= @jsapi_params[:timeStamp] %>,
        nonceStr: '<%= @jsapi_params[:nonceStr] %>',
        package: '<%= @jsapi_params[:package] %>',
        signType: '<%= @jsapi_params[:signType] %>',
        paySign: '<%= @jsapi_params[:paySign] %>',
        success: function (res) {
          window.location.href = '<%= wechat_shop_order_path(@order.order_no) %>';
        },
        cancel: function (res) {
          window.location.href = '<%= wechat_shop_order_path(@order.order_no) %>';
        }
      });
    <% else %>
      window.location.href = '<%= wechat_shop_order_path(@order.order_no) %>';
    <% end %>
  <% else %>
    App.alert('支付订单失败', '.new-order');
  <% end %>
<% else %>
  App.alert('地址不能为空', '.new-order');
<% end %>