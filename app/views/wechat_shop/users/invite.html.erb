<%= render_navbar_for('邀请朋友得优惠', 
{ icon: 'fa fa-angle-left', link: "#{settings_wechat_shop_user_path}" }) %>

<div class="container">
  
  <div class="share-invite-icon">
    <%= invite_icon_tag(@invite) %>
  </div>
  
  <div class="share-invite-body">
    <%= @invite.body %>
  </div>
  
  <div class="share-tip">
    <h2 class="green">点击右上角分享得<%= @invite.inviter_coupon_value %>元奖励</h2>
  </div>
</div>

<!-- <div class="share-buttons">
  <a href="javascript:;" class="share-friend share-button" onclick="shareFriend();">分享给朋友</a>
  <a href="javascript:;" class="share-timeline share-button" onclick="shareTimeline();">分享到朋友圈</a>
</div> -->

<% content_for :scripts do %>

<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
<%
@sign_package = WX::Sign.sign_package(request.original_url)
@pay_params = WX::Pay.generate_jsapi_params('wx201604162008434cb1b4357a0145578425')
%>
wx.config({
  debug: <%= @sign_package[:debug] %>,
  appId: '<%= @sign_package[:appId] %>',
  timestamp: <%= @sign_package[:timestamp] %>,
  nonceStr: '<%= @sign_package[:nonceStr] %>',
  signature: '<%= @sign_package[:signature] %>',
  jsApiList: ['chooseWXPay','onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareQZone','openLocation','getLocation']
  
});
    // wx.ready(function() {
//       console.log('配置成功成功');
//     });
</script>

<script>

var imgUrl = "<%= @invite.share_icon_url %>";
var lineLink = "<%= @invite.link %>" + '?code=<%= current_user.nb_code %>';
var descContent = "<%= @invite.body %>";
var shareTitle = '<%= @invite.title %>';
  
wx.ready(function() {
  // console.log('配置成功');
  
  wx.chooseWXPay({
      timestamp: <%= @pay_params[:timeStamp] %>,
      nonceStr: '<%= @pay_params[:nonceStr] %>',
      package: '<%= @pay_params[:package] %>',
      signType: 'MD5',
      paySign: '<%= @pay_params[:paySign] %>',
      success: function (res) {
          // 支付成功后的回调函数
          console.log(res);
      }
  });
  
  wx.onMenuShareAppMessage({
      title: shareTitle, // 分享标题
      desc: descContent, // 分享描述
      link: lineLink, // 分享链接
      imgUrl: imgUrl, // 分享图标
      type: '', // 分享类型,music、video或link，不填默认为link
      dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
      success: function () { 
          // 用户确认分享后执行的回调函数
          console.log('成功');
      },
      cancel: function () { 
          // 用户取消分享后执行的回调函数
          console.log('取消');
      }
  });

  // 分享到朋友圈
  wx.onMenuShareTimeline({
      title: shareTitle, // 分享标题
      link: lineLink, // 分享链接
      imgUrl: imgUrl, // 分享图标
      success: function () { 
          // 用户确认分享后执行的回调函数
          console.log('成功分享到朋友圈');
      },
      cancel: function () { 
          // 用户取消分享后执行的回调函数
          console.log('取消');
      }
  });
  
  // 分享到QQ
  wx.onMenuShareQQ({
      title: shareTitle, // 分享标题
      desc: descContent, // 分享描述
      link: lineLink, // 分享链接
      imgUrl: imgUrl, // 分享图标
      success: function () { 
         // 用户确认分享后执行的回调函数
      },
      cancel: function () { 
         // 用户取消分享后执行的回调函数
      }
  });
  
  // 分享到QZone
  wx.onMenuShareQZone({
      title: shareTitle, // 分享标题
      desc: descContent, // 分享描述
      link: lineLink, // 分享链接
      imgUrl: imgUrl, // 分享图标
      success: function () { 
         // 用户确认分享后执行的回调函数
      },
      cancel: function () { 
          // 用户取消分享后执行的回调函数
      }
  });
  
});


</script>
<% end %>